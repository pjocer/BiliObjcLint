# BiliObjCLint 默认配置
# 复制此文件到项目根目录并重命名为 .biliobjclint.yaml

# ==================== 基础配置 ====================
# 增量检查的基准分支
# - 设为 "" 或 "HEAD": 只检查未提交的变更（本地开发推荐）
# - 设为 "origin/master": 检查从 master 分叉后的所有变更（CI/PR 检查推荐）
base_branch: ""

# 是否启用增量检查（只检查 git 变更的代码）
incremental: true

# error 级别的违规是否导致编译失败
fail_on_error: true

# ==================== 文件过滤 ====================
# 包含的文件模式
included:
  - "**/*.m"
  - "**/*.mm"
  - "**/*.h"

# 排除的文件/目录模式
excluded:
  - "Pods/**"
  - "Vendor/**"
  - "ThirdParty/**"
  - "**/Generated/**"
  - "**/*Test*.m"
  - "**/*Tests.m"
  - "**/*Mock*.m"

# ==================== OCLint 配置 ====================
oclint:
  # 是否启用 OCLint
  enabled: true

  # 启用的规则（为空表示使用默认规则）
  enable_rules: []

  # 禁用的规则
  disable_rules:
    - LongLine  # 由 Python 规则处理，避免重复

  # 规则参数配置
  rule_configurations:
    - key: LONG_METHOD
      value: 80
    - key: LONG_LINE
      value: 120
    - key: CYCLOMATIC_COMPLEXITY
      value: 10
    - key: NPATH_COMPLEXITY
      value: 200
    - key: LONG_VARIABLE_NAME
      value: 30
    - key: SHORT_VARIABLE_NAME
      value: 2
    - key: LONG_CLASS
      value: 1000
    - key: TOO_MANY_FIELDS
      value: 20
    - key: TOO_MANY_METHODS
      value: 50
    - key: TOO_MANY_PARAMETERS
      value: 6

# ==================== Python 规则配置 ====================
python_rules:
  # ---------- 命名规范 ----------
  class_prefix:
    enabled: false  # 默认关闭，需要配置前缀后启用
    severity: warning
    params:
      prefix: ""  # 设置类名前缀，如 "BL"

  property_naming:
    enabled: true
    severity: warning

  constant_naming:
    enabled: true
    severity: warning

  method_naming:
    enabled: true
    severity: warning

  # ---------- 代码风格 ----------
  line_length:
    enabled: true
    severity: warning
    params:
      max_length: 120

  method_length:
    enabled: true
    severity: warning
    params:
      max_lines: 80

  todo_fixme:
    enabled: true
    severity: warning

  # ---------- 内存安全 ----------
  weak_delegate:
    enabled: true
    severity: error

  block_retain_cycle:
    enabled: true
    severity: warning

  wrapper_empty_pointer:
    enabled: true
    severity: warning

  dict_usage:
    enabled: true
    severity: warning

  collection_mutation:
    enabled: true
    severity: warning

  # ---------- 安全规则 ----------
  forbidden_api:
    enabled: false  # 默认关闭
    severity: error
    params:
      apis: []
      # 示例配置:
      # apis:
      #   - pattern: "NSLog\\s*\\("
      #     message: "请使用 BLLog 替代 NSLog"
      #   - pattern: "\\[NSUserDefaults standardUserDefaults\\]"
      #     message: "请使用 BLUserDefaults"

  hardcoded_credentials:
    enabled: true
    severity: error

  insecure_random:
    enabled: true
    severity: warning

  # ---------- 文件规范 ----------
  file_header:
    enabled: false  # 默认关闭，需要配置模板后启用
    severity: warning
    params:
      required_patterns: []
      # 示例配置:
      # required_patterns:
      #   - "Copyright"
      #   - "Created by"

# ==================== 自定义规则 ====================
custom_rules:
  # Python 自定义规则
  python:
    enabled: true
    path: "./custom_rules/python/"

  # C++ 自定义规则（编译后自动加载）
  cpp:
    enabled: true

# ==================== 严重级别映射 ====================
# OCLint priority 到 Xcode 严重级别的映射
severity_mapping:
  priority1: error    # P1 → 红色错误，中断编译
  priority2: warning  # P2 → 黄色警告
  priority3: warning  # P3 → 黄色警告

# ==================== Claude 自动修复配置 ====================
claude_autofix:
  # 触发模式
  # - any: 任何违规时都弹窗询问
  # - error: 仅当存在 error 级别违规时弹窗
  # - disable: 禁用自动弹窗（可通过命令行手动触发）
  trigger: "any"

  # 执行模式
  # - silent: 静默修复（后台执行，显示进度和结果弹窗）
  # - terminal: 打开 Terminal.app 与 Claude 交互
  # - vscode: 在 VSCode 中打开项目，将 prompt 复制到剪贴板
  mode: "silent"

  # 修复超时时间（秒），仅对 silent 模式有效
  timeout: 120

# ==================== 本地 Pod 检测配置 ====================
local_pods:
  # 是否启用本地 Pod 检测
  enabled: true
  # 是否对本地 Pod 进行增量检测
  # - true: 只检查本地 Pod 的 git 变更（推荐）
  # - false: 全量检查本地 Pod 的所有文件
  incremental: true
  # 本地 Pod 的包含模式（空表示所有）
  included_pods: []
  # 本地 Pod 的排除模式
  excluded_pods:
    - "*Test*"
    - "*Mock*"
