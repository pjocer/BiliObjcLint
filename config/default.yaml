# BiliObjCLint 默认配置
# 此文件会被复制到项目的 .biliobjclint/config.yaml

# ==================== 基础配置 ====================
# 增量检查的基准分支
# - 设为 "" 或 "HEAD": 只检查未提交的变更（本地开发推荐）
# - 设为 "origin/master": 检查从 master 分叉后的所有变更（CI/PR 检查推荐）
base_branch: ""

# 是否启用增量检查（只检查 git 变更的代码）
incremental: true

# error 级别的违规是否导致编译失败
fail_on_error: true

# ==================== 文件过滤 ====================
# 包含的文件模式
included:
  - "**/*.m"
  - "**/*.mm"
  - "**/*.h"

# 排除的文件/目录模式
excluded:
  - "Pods/**"
  - "**/Vendor/**"
  - "**/ThirdParty/**"
  - "**/Generated/**"
  - "**/*Test*.m"
  - "**/*Tests.m"
  - "**/*Mock*.m"

# ==================== Python 规则配置 ====================
python_rules:
  # ---------- 命名规范 ----------
  class_prefix:
    enabled: false  # 默认关闭，需要配置前缀后启用
    severity: warning
    params:
      prefix: ""  # 设置类名前缀，如 "BL"

  property_naming:
    enabled: true
    severity: warning

  constant_naming:
    enabled: true
    severity: warning

  method_naming:
    enabled: true
    severity: warning

  method_parameter:
    enabled: true
    severity: warning
    params:
      max_params: 4  # 最大参数数量

  # ---------- 代码风格 ----------
  line_length:
    enabled: true
    severity: warning
    params:
      max_length: 120

  method_length:
    enabled: true
    severity: warning
    params:
      max_lines: 80

  todo_fixme:
    enabled: true
    severity: warning

  # ---------- 内存安全 ----------
  weak_delegate:
    enabled: true
    severity: error

  block_retain_cycle:
    enabled: true
    severity: warning

  wrapper_empty_pointer:
    enabled: true
    severity: warning

  dict_usage:
    enabled: true
    severity: warning

  collection_mutation:
    enabled: true
    severity: warning

  # ---------- 安全规则 ----------
  forbidden_api:
    enabled: false  # 默认关闭
    severity: error
    params:
      apis: []
      # 示例配置:
      # apis:
      #   - pattern: "NSLog\\s*\\("
      #     message: "请使用 BLLog 替代 NSLog"
      #   - pattern: "\\[NSUserDefaults standardUserDefaults\\]"
      #     message: "请使用 BLUserDefaults"

  hardcoded_credentials:
    enabled: true
    severity: error

  insecure_random:
    enabled: true
    severity: warning

  # ---------- 文件规范 ----------
  file_header:
    enabled: false  # 默认关闭，需要配置模板后启用
    severity: warning
    params:
      required_patterns: []
      # 示例配置:
      # required_patterns:
      #   - "Copyright"
      #   - "Created by"

# ==================== 自定义规则 ====================
custom_rules:
  # Python 自定义规则
  python:
    enabled: true
    path: "./custom_rules/python/"

# ==================== Claude 自动修复配置 ====================
claude_autofix:
  # 触发模式
  # - any: 任何违规时都弹窗询问
  # - error: 仅当存在 error 级别违规时弹窗
  # - disable: 禁用自动弹窗（可通过命令行手动触发）
  trigger: "any"

  # 执行模式
  # - silent: 静默修复（后台执行，显示进度和结果弹窗）
  # - terminal: 打开 Terminal.app 与 Claude 交互
  # - vscode: 在 VSCode 中打开项目，将 prompt 复制到剪贴板
  mode: "silent"

  # 修复超时时间（秒），仅对 silent 模式有效
  timeout: 120

  # ---------- Claude Code API 配置 ----------
  # 以下配置用于 Claude Code CLI 调用，支持两种方式：
  #
  # 方式一：使用内部网关（推荐公司内部使用）
  #   设置 api_base_url 指向内部网关地址，使用 api_token 认证
  #   示例：
  #     api_base_url: "http://llmapi.bilibili.co"
  #     api_token: "bsk-xxxxxxxxxxxx"
  #
  # 方式二：使用官方 Claude API
  #   不设置 api_base_url（留空），使用 api_key 认证
  #   示例：
  #     api_base_url: ""
  #     api_key: "sk-ant-xxxxxxxxxxxx"
  #
  # 注意：api_token 和 api_key 二选一即可，优先使用 api_token
  # 如果配置为空，将尝试从环境变量或 ~/.zshrc 中读取

  # API 基础地址（内部网关地址，留空则使用官方 API）
  api_base_url: ""

  # API 认证令牌（用于内部网关，对应 ANTHROPIC_AUTH_TOKEN）
  api_token: ""

  # API 密钥（用于官方 API，对应 ANTHROPIC_API_KEY）
  api_key: ""

  # Claude 模型名称（留空则使用 Claude Code 默认模型）
  # 常用模型：claude-4.5-opus, claude-4.5-sonnet, claude-4-opus
  model: ""

  # 是否禁用非必要的网络请求（推荐开启以提高性能）
  disable_nonessential_traffic: true

# ==================== 统计上报配置 ====================
metrics:
  # 是否启用统计上报
  enabled: false
  # 上报服务地址
  endpoint: "http://127.0.0.1:18080"
  # 上报鉴权 Token（与服务端配置一致）
  token: ""
  # 上报模式: push
  mode: "push"
  # 本地缓存目录（上报失败时落盘）
  spool_dir: "~/.biliobjclint/metrics_spool"
  # 请求超时时间（毫秒）
  timeout_ms: 2000
  # 失败重试次数
  retry_max: 3
  #
  # 注意：project_key 和 project_name 从 Xcode 环境变量自动读取：
  # - project_key: 优先使用 WORKSPACE_DIR 的末端路径名，否则使用 PROJECT_NAME
  # - project_name: 使用 TARGET_NAME 环境变量

# ==================== 本地 Pod 检测配置 ====================
local_pods:
  # 是否启用本地 Pod 检测
  enabled: true
  # 是否对本地 Pod 进行增量检测
  # - true: 只检查本地 Pod 的 git 变更（推荐）
  # - false: 全量检查本地 Pod 的所有文件
  incremental: true
  # 本地 Pod 的包含模式（空表示所有）
  included_pods: []
  # 本地 Pod 的排除模式
  excluded_pods:
    - "*Test*"
    - "*Mock*"

# ==================== 性能优化配置 ====================
performance:
  # 是否启用并行检查（多文件并行执行规则检查）
  parallel: true
  # 最大工作线程数
  # - 0: 自动（min(32, CPU核心数 * 2)）
  # - >0: 指定线程数
  max_workers: 0
  # 文件内容缓存最大容量（MB）
  file_cache_size_mb: 100
  # 是否启用规则结果缓存（持久化到磁盘，跨编译复用）
  # 注意：仅在全量模式下生效，增量模式不使用此缓存
  result_cache_enabled: true
